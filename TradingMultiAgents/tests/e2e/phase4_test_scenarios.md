# TradingAgents WebUI E2E Test Scenarios - Phase 4

## 概要
Phase 4では、実際のユーザー行動を模倣したシナリオベースのE2Eテストを実装します。
これらのテストは、既存のPhase 1-3の基本機能テストを拡張し、より複雑で現実的なユースケースをカバーします。

## 1. 完全分析フローシナリオ

### テストID: E2E-P4-001
**シナリオ名**: 初回ユーザーの完全分析フロー
**目的**: 新規ユーザーが環境設定から結果確認まで全工程を実行できることを検証

**前提条件**:
- ブラウザのローカルストレージがクリアされている
- 環境変数が未設定の状態

**テストステップ**:
1. WebUIを起動し、初回起動画面を確認
2. 環境変数未設定の警告を確認
3. 設定ページへ移動し、APIキーを設定
4. 設定保存後、環境チェックが成功することを確認
5. ダッシュボードに戻り、クイックアクション「SPY」をクリック
6. 実行ページへ自動遷移を確認
7. 分析を開始し、進捗表示を確認
8. 分析完了後、結果ページへ自動遷移
9. 結果サマリーとチャートが表示されることを確認
10. PDFレポートを生成し、ダウンロードを確認

**期待結果**:
- 各ステップでエラーが発生しないこと
- UIの状態遷移が適切に行われること
- 最終的にPDFレポートが生成されること

**検証項目**:
- [ ] 初回起動時の環境チェック機能
- [ ] APIキー設定と検証プロセス
- [ ] ページ間の自動遷移
- [ ] 分析実行の完全性
- [ ] PDF生成機能

### テストID: E2E-P4-002
**シナリオ名**: プリセット活用による効率的分析
**目的**: 各種プリセット機能を使用した迅速な分析設定を検証

**テストステップ**:
1. 設定ページを開く
2. 「テクニカル重視」プリセットを選択
3. 適切なアナリストが選択されることを確認
4. 日付プリセット「過去1ヶ月」を選択
5. 日付が正しく設定されることを確認
6. LLMプリセットで高速モデルを選択
7. 設定を保存し、実行ページへ移動
8. 設定が正しく引き継がれていることを確認

**検証項目**:
- [ ] アナリストプリセットの動作
- [ ] 日付プリセットの計算精度
- [ ] LLMモデルプリセットの適用
- [ ] プリセット組み合わせの整合性

### テストID: E2E-P4-003
**シナリオ名**: カスタム詳細設定での高度な分析
**目的**: 全ての詳細設定を使用した分析フローを検証

**テストステップ**:
1. 設定ページで「詳細設定を表示」を展開
2. カスタムバックエンドURLを設定
3. タイムアウトを300秒に設定
4. デバッグモードを有効化
5. 研究深度を最大値（5）に設定
6. 全てのアナリストを選択
7. 実行し、デバッグログが表示されることを確認
8. タイムアウト設定が適用されることを確認

**検証項目**:
- [ ] 詳細設定の保存と適用
- [ ] デバッグモードでのログ出力
- [ ] カスタムタイムアウトの動作
- [ ] 研究深度による処理時間の変化

## 2. マルチセッション管理シナリオ

### テストID: E2E-P4-004
**シナリオ名**: 複数銘柄の順次分析
**目的**: 複数の銘柄を連続して分析する際の状態管理を検証

**テストステップ**:
1. AAPL銘柄で分析を実行
2. 分析完了後、設定ページに戻る
3. 銘柄をMSFTに変更し、再度分析実行
4. 結果ページで銘柄セレクタを確認
5. AAPLとMSFTの結果が両方選択可能なことを確認
6. 各結果を切り替えて表示内容を確認

**検証項目**:
- [ ] 複数分析結果の保存
- [ ] 結果セレクタの動的更新
- [ ] 銘柄切り替え時のデータ分離

### テストID: E2E-P4-005
**シナリオ名**: 分析中の設定変更と再実行
**目的**: 実行中の分析への影響なく設定変更が可能なことを検証

**テストステップ**:
1. 長時間分析（研究深度5）を開始
2. 実行中に設定ページへ移動
3. 別の銘柄と設定で新規分析を準備
4. 最初の分析が継続中であることを確認
5. 新規分析を開始（並行実行の確認）
6. 両方の分析結果を確認

**検証項目**:
- [ ] 実行中分析の独立性
- [ ] 並行実行の可否
- [ ] セッション状態の分離

### テストID: E2E-P4-006
**シナリオ名**: 実行中断と再開
**目的**: 分析の中断と再実行が適切に処理されることを検証

**テストステップ**:
1. 分析を開始
2. 進捗が50%程度で「停止」ボタンをクリック
3. 中断確認ダイアログで「はい」を選択
4. 実行が停止することを確認
5. 同じ設定で再度実行
6. 新規実行として開始されることを確認

**検証項目**:
- [ ] 停止機能の即時性
- [ ] 中断時のクリーンアップ
- [ ] 再実行時の初期化

## 3. エラーリカバリーシナリオ

### テストID: E2E-P4-007
**シナリオ名**: API制限エラーからの回復
**目的**: API制限に達した際の適切なエラーハンドリングを検証

**前提条件**:
- モックAPIでレート制限エラーを返すよう設定

**テストステップ**:
1. 分析を開始
2. API制限エラーが発生することを確認
3. エラーメッセージが適切に表示されることを確認
4. リトライオプションが提示されることを確認
5. 待機後、リトライを実行
6. 分析が再開されることを確認

**検証項目**:
- [ ] エラーメッセージの明確性
- [ ] リトライ機能の動作
- [ ] エラー状態からの回復

### テストID: E2E-P4-008
**シナリオ名**: ネットワーク切断時の処理
**目的**: ネットワーク障害時の適切な処理を検証

**テストステップ**:
1. 分析を開始
2. ネットワークを切断（開発者ツールで制御）
3. エラー通知が表示されることを確認
4. ネットワークを復旧
5. 自動リトライまたは手動再開オプションを確認
6. 分析が継続/再開されることを確認

**検証項目**:
- [ ] ネットワークエラーの検出
- [ ] ユーザーへの適切な通知
- [ ] 復旧後の処理継続性

### テストID: E2E-P4-009
**シナリオ名**: 不正入力データの検証
**目的**: 各種不正入力に対する検証機能を確認

**テストステップ**:
1. 設定ページで以下の不正入力を試行:
   - 存在しない銘柄コード
   - 未来の日付
   - 無効な日付範囲（終了日 < 開始日）
   - 空のAPIキー
   - 特殊文字を含む入力
2. 各ケースで適切なエラーメッセージを確認
3. 実行が防止されることを確認
4. 正しい入力で実行可能なことを確認

**検証項目**:
- [ ] 入力検証の網羅性
- [ ] エラーメッセージの具体性
- [ ] 検証後の入力フィールド状態

## 4. データ永続性検証シナリオ

### テストID: E2E-P4-010
**シナリオ名**: 設定の永続化と復元
**目的**: ユーザー設定が適切に保存・復元されることを検証

**テストステップ**:
1. カスタム設定を作成（全項目を変更）
2. 設定を保存
3. ブラウザをリロード
4. 設定が復元されることを確認
5. アプリケーションを再起動
6. 設定が維持されることを確認
7. 「設定をリセット」機能を実行
8. デフォルト値に戻ることを確認

**検証項目**:
- [ ] 設定の完全な保存
- [ ] リロード後の復元
- [ ] 再起動後の永続性
- [ ] リセット機能の動作

### テストID: E2E-P4-011
**シナリオ名**: 分析履歴の管理
**目的**: 複数の分析結果が適切に管理されることを検証

**テストステップ**:
1. 5つの異なる銘柄で分析を実行
2. 結果ページで履歴一覧を確認
3. 各結果のタイムスタンプを確認
4. 古い結果から順に表示内容を確認
5. 結果ファイルの整合性を検証
6. ディスク容量を確認（ローテーション機能）

**検証項目**:
- [ ] 履歴の正確な記録
- [ ] タイムスタンプの精度
- [ ] 結果ファイルの完全性
- [ ] ストレージ管理機能

### テストID: E2E-P4-012
**シナリオ名**: セッション跨ぎのデータ整合性
**目的**: 異なるセッション間でのデータ一貫性を検証

**テストステップ**:
1. セッション1で分析を開始
2. 別ブラウザ/タブでセッション2を開始
3. セッション2から実行状態を確認
4. セッション1で分析完了
5. セッション2で結果が確認可能なことを検証
6. 両セッションでのデータ同期を確認

**検証項目**:
- [ ] マルチセッション対応
- [ ] リアルタイムデータ同期
- [ ] セッション間の干渉防止

## 5. パフォーマンス境界テストシナリオ

### テストID: E2E-P4-013
**シナリオ名**: 長期間データの処理
**目的**: 大量の履歴データを処理する際のパフォーマンスを検証

**テストステップ**:
1. 5年間のデータ範囲を設定
2. 全アナリストを有効化
3. 研究深度を最大に設定
4. 分析を開始し、処理時間を計測
5. メモリ使用量をモニタリング
6. UIの応答性を確認
7. 結果表示のパフォーマンスを確認

**検証項目**:
- [ ] 処理時間の妥当性（基準：10分以内）
- [ ] メモリ使用量の上限（基準：2GB以内）
- [ ] UI応答性の維持
- [ ] 大量データの表示性能

### テストID: E2E-P4-014
**シナリオ名**: 大量ログの表示処理
**目的**: 大規模なログデータの表示性能を検証

**テストステップ**:
1. デバッグモードで長時間分析を実行
2. 10MB以上のログが生成されることを確認
3. ログ表示のスクロール性能を確認
4. ログフィルタリング機能の応答性を確認
5. ログ検索機能のパフォーマンスを確認

**検証項目**:
- [ ] ログ表示の初期ロード時間（基準：3秒以内）
- [ ] スクロールの滑らかさ
- [ ] フィルタリングの即時性
- [ ] 検索機能の応答時間

### テストID: E2E-P4-015
**シナリオ名**: 同時複数分析の負荷テスト
**目的**: 複数の分析を同時実行した際のシステム安定性を検証

**テストステップ**:
1. 3つの異なるブラウザタブを開く
2. 各タブで異なる銘柄の分析を同時開始
3. 全ての分析の進捗を監視
4. システムリソースの使用状況を確認
5. 各分析が正常完了することを確認
6. 結果の整合性を検証

**検証項目**:
- [ ] 同時実行の上限確認
- [ ] リソース競合の防止
- [ ] 各分析の独立性
- [ ] システム全体の安定性

## 実装優先順位

1. **高優先度**（Phase 4 Week 1）:
   - E2E-P4-001: 初回ユーザーフロー
   - E2E-P4-004: 複数銘柄分析
   - E2E-P4-007: API制限エラー

2. **中優先度**（Phase 4 Week 2）:
   - E2E-P4-010: 設定永続化
   - E2E-P4-013: 長期間データ処理
   - E2E-P4-009: 入力検証

3. **低優先度**（Phase 5）:
   - E2E-P4-015: 同時実行負荷
   - E2E-P4-012: セッション整合性
   - その他の詳細シナリオ

## テスト実行環境

- **ブラウザ**: Chrome (latest), Firefox, Safari
- **画面解像度**: 1920x1080, 1366x768, Mobile (375x667)
- **ネットワーク**: 通常、3G、オフライン
- **データセット**: モックAPI、実API（制限付き）