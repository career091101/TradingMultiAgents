# 分析結果表示の最適化設定

## 実施日時
2025年7月16日

## 表示設定の全体像

### サマリーダッシュボード
- **ポジティブ要因**: 5個まで表示（+エキスパンダーで3個追加）
- **リスク要因**: 5個まで表示（+エキスパンダーで3個追加）
- **最終判断理由**: 300文字まで表示
- **文字数処理**: 150文字以下はそのまま、超える場合は句読点で自然に区切る

### PDFサマリー
- **ポジティブ要因**: 5個まで表示
- **リスク要因**: 5個まで表示
- **推奨事項**: 8個まで抽出

## 分析結果に基づく最適化

### 1. 実際のテキスト長分析
実際の分析レポートを調査した結果：
- **短い項目**: 15-30文字（例：「AI・クラウドの成長ドライバー」）
- **中程度の項目**: 40-60文字（例：「AWS・GCPとの価格競争、迅速なイノベーション追随」）
- **長い項目**: 60-150文字（詳細な説明や条件を含む文）
- **推奨事項**: 50-200文字（具体的なアクション指示）

### 2. 実装した最適化

#### 文字数処理の改善
```python
# ポジティブ要因・リスク要因
if len(clean_line) <= 150:
    points.append(clean_line)  # 150文字以下はそのまま表示
else:
    # 長い文は句読点で適切に切る
    cutoff_point = clean_line[:150].rfind('。')
    if cutoff_point > 100:
        points.append(clean_line[:cutoff_point + 1])
    else:
        points.append(clean_line[:150] + "...")

# 推奨事項（より詳細な情報が必要）
if len(clean_line) <= 200:
    recommendations.append(clean_line)  # 200文字以下はそのまま
else:
    # 長い文は句読点で切る
    cutoff_point = clean_line[:200].rfind('。')
    if cutoff_point > 150:
        recommendations.append(clean_line[:cutoff_point + 1])
    else:
        recommendations.append(clean_line[:200] + "...")
```

#### 表示項目数の最適化
- **ポジティブ要因・リスク要因**: 最大12個まで抽出（短い順にソート）
- **推奨事項**: 最大8個まで表示
- **初期表示**: 各5個（残りはエキスパンダーで表示）

#### エキスパンダー機能の追加
```python
if len(positive_points) > 5:
    # 最初の5個を表示
    for i, point in enumerate(positive_points[:5]):
        st.markdown(f"• {point}")
    
    # 残りはエキスパンダーに
    with st.expander(f"さらに表示 ({len(positive_points) - 5}件)"):
        for i, point in enumerate(positive_points[5:8]):
            st.markdown(f"• {point}")
```

### 3. 改善効果

1. **文章の完全性向上**
   - 句読点での自然な区切りにより、意味が途切れることを防止
   - 150-200文字の範囲で、ほとんどの分析文が完全に表示される

2. **読みやすさの向上**
   - 短い項目を優先表示することで、概要が把握しやすい
   - エキスパンダーで詳細情報へのアクセスも可能

3. **情報量の最大化**
   - 最大12個の要因を抽出（従来は10個）
   - 画面を圧迫せずに多くの情報を提供

### 4. 今後の拡張案

1. **重要度によるソート**
   - 現在は文字数順だが、キーワードベースの重要度判定も可能

2. **カテゴリ分類**
   - ポジティブ要因を「成長要因」「競争優位」「財務健全性」等に分類

3. **ツールチップ表示**
   - 短縮された項目にマウスオーバーで全文表示

4. **ユーザー設定**
   - 表示項目数や文字数制限をユーザーが調整可能に