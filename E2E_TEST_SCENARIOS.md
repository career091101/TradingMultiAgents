# TradingAgents WebUI E2Eテストシナリオ詳細

## テストシナリオ一覧

### 🏠 ダッシュボード（Main Page）

#### TC001: 初回アクセス
```gherkin
Given WebUIが起動している
When http://localhost:8501 にアクセスする
Then ページタイトルが "TradingAgents WebUI" である
And ヘッダーに "📈 TradingAgents WebUI" が表示される
And サイドバーが表示される
And 統計情報セクションが表示される
And スクリーンショットを "dashboard_initial.png" として保存
```

#### TC002: 統計情報の検証
```gherkin
Given ダッシュボードページを表示している
When 統計情報セクションを確認する
Then 以下の情報が表示される:
  | 項目         | 期待値              |
  | 総分析数     | 数値が表示される     |
  | 完了分析     | 緑色のチェックマーク |
  | 実行中       | 青色のアイコン      |
  | 成功率       | パーセンテージ表示   |
```

#### TC003: 人気銘柄分析の操作
```gherkin
Given ダッシュボードページを表示している
When 人気銘柄分析セクションを確認する
Then 以下の銘柄が表示される:
  | 銘柄 | ETF名          |
  | SPY  | S&P 500 ETF    |
  | QQQ  | NASDAQ 100 ETF |
  | AAPL | Apple Inc.     |
  | MSFT | Microsoft Corp.|
And 各銘柄に "分析開始" ボタンがある
When "SPY" の分析開始ボタンをクリック
Then 分析実行ページに遷移する
```

### ⚙️ 設定ページ（Settings）

#### TC004: 設定ページへのナビゲーション
```gherkin
Given ダッシュボードページを表示している
When サイドバーの "分析設定" をクリック
Then 設定ページが表示される
And URLが "#settings" を含む
And "API Keys" セクションが表示される
And スクリーンショットを "settings_page.png" として保存
```

#### TC005: APIキー設定
```gherkin
Given 設定ページを表示している
When "FINNHUB_API_KEY" フィールドに "test_key_123" を入力
And "OPENAI_API_KEY" フィールドに "sk-test123" を入力
And "保存" ボタンをクリック
Then 成功メッセージが表示される
And 入力値がマスクされて表示される（例: "sk-***123"）
```

#### TC006: モデル選択
```gherkin
Given 設定ページを表示している
When "Deep Thinking LLM" ドロップダウンをクリック
Then 以下の選択肢が表示される:
  | モデル名           |
  | gpt-4             |
  | claude-3-opus     |
  | gpt-4-turbo       |
When "gpt-4" を選択
Then 選択が保持される
```

### 📊 分析実行ページ（Execution）

#### TC007: 基本的な分析実行
```gherkin
Given 分析実行ページを表示している
When 銘柄シンボルフィールドに "AAPL" を入力
And "分析を実行" ボタンをクリック
Then プログレスバーが表示される
And "分析を実行中..." メッセージが表示される
And 30秒以内に結果が表示される
And スクリーンショットを "execution_result.png" として保存
```

#### TC008: 入力検証
```gherkin
Given 分析実行ページを表示している
When 銘柄シンボルフィールドに以下を入力してテスト:
  | 入力値    | 期待結果                |
  | ""       | エラー: 銘柄を入力してください |
  | "123"    | エラー: 無効な銘柄です        |
  | "INVALID"| エラー: 銘柄が見つかりません   |
  | "AAPL"   | 正常に受け付けられる          |
```

#### TC009: 複数銘柄の分析
```gherkin
Given 分析実行ページを表示している
When 複数銘柄モードを有効にする
And 銘柄リストに "AAPL,MSFT,GOOGL" を入力
And "バッチ分析を実行" ボタンをクリック
Then 各銘柄の進捗が個別に表示される
And すべての分析が完了するまで待機
```

### 📈 結果表示ページ（Results）

#### TC010: 分析結果の表示
```gherkin
Given 分析が完了している
When 結果表示ページを開く
Then 以下の要素が表示される:
  | 要素              | 内容                    |
  | 銘柄情報          | シンボル、会社名、業種    |
  | 価格チャート      | インタラクティブなグラフ  |
  | テクニカル指標    | RSI、MACD、ボリンジャー  |
  | AI分析結果        | 各エージェントの分析     |
  | 推奨アクション    | Buy/Hold/Sell判定       |
```

#### TC011: PDFレポート生成
```gherkin
Given 分析結果が表示されている
When "PDFレポートを生成" ボタンをクリック
Then PDFが生成される
And ファイル名が "TradingAgents_Report_AAPL_YYYYMMDD.pdf" 形式
And PDFに以下が含まれる:
  | コンテンツ        |
  | エグゼクティブサマリー |
  | 詳細分析結果      |
  | チャート画像      |
  | 免責事項         |
```

### 📱 レスポンシブデザイン

#### TC012: モバイル表示（iPhone）
```gherkin
Given ビューポートを 375x812 に設定
When 各ページを表示
Then サイドバーがハンバーガーメニューになる
And コンテンツが縦スクロール可能
And タッチ操作が可能
And 各ページのスクリーンショットを保存:
  | ページ    | ファイル名              |
  | ダッシュボード | mobile_dashboard.png   |
  | 設定      | mobile_settings.png    |
  | 実行      | mobile_execution.png   |
  | 結果      | mobile_results.png     |
```

#### TC013: タブレット表示（iPad）
```gherkin
Given ビューポートを 768x1024 に設定
When 各ページを表示
Then サイドバーが折りたたみ可能
And グリッドレイアウトが2列表示
And 横向き回転時にレイアウトが調整される
```

### 🚨 エラーハンドリング

#### TC014: ネットワークエラー
```gherkin
Given ネットワークを切断した状態
When 分析を実行する
Then エラーメッセージ "ネットワーク接続を確認してください" が表示
And リトライボタンが表示される
```

#### TC015: API制限エラー
```gherkin
Given APIレート制限に達している
When 分析を実行する
Then エラーメッセージ "API制限に達しました。しばらくお待ちください" が表示
And 待機時間が表示される
```

### ⚡ パフォーマンステスト

#### TC016: ページ読み込み時間
```gherkin
Given パフォーマンス測定モード
When 各ページにアクセス
Then 以下の基準を満たす:
  | ページ     | 最大読み込み時間 |
  | ダッシュボード | 3秒            |
  | 設定       | 2秒            |
  | 実行       | 2秒            |
  | 結果       | 5秒            |
```

#### TC017: 大量データ処理
```gherkin
Given 100件の分析履歴がある
When 結果一覧を表示
Then 仮想スクロールが有効
And 初期表示は20件
And スクロールで追加読み込み
And メモリ使用量が500MB以下
```

### 🔐 セキュリティテスト

#### TC018: XSS攻撃の防御
```gherkin
Given 分析実行ページ
When 銘柄フィールドに "<script>alert('XSS')</script>" を入力
Then スクリプトが実行されない
And エスケープされたテキストとして表示
```

#### TC019: APIキーの保護
```gherkin
Given 設定ページでAPIキーを入力済み
When ブラウザの開発者ツールでネットワークを確認
Then APIキーが平文で送信されていない
And LocalStorageにAPIキーが保存されていない
```

## テスト実行マトリックス

| テストID | Chrome | Firefox | Safari | Mobile | 優先度 | 実行時間 |
|---------|--------|---------|--------|---------|--------|---------|
| TC001   | ✓      | ✓       | ✓      | ✓       | 高     | 5秒     |
| TC002   | ✓      | ✓       | ✓      | ✓       | 高     | 3秒     |
| TC003   | ✓      | ✓       | ✓      | ✓       | 高     | 10秒    |
| TC004   | ✓      | ✓       | ✓      | ✓       | 高     | 5秒     |
| TC005   | ✓      | ✓       | ✓      | -       | 高     | 15秒    |
| TC006   | ✓      | ✓       | ✓      | -       | 中     | 10秒    |
| TC007   | ✓      | ✓       | -      | -       | 高     | 45秒    |
| TC008   | ✓      | ✓       | -      | -       | 高     | 20秒    |
| TC009   | ✓      | -       | -      | -       | 中     | 120秒   |
| TC010   | ✓      | ✓       | ✓      | ✓       | 高     | 15秒    |
| TC011   | ✓      | -       | -      | -       | 中     | 30秒    |
| TC012   | ✓      | -       | -      | ✓       | 高     | 20秒    |
| TC013   | ✓      | -       | -      | ✓       | 中     | 15秒    |
| TC014   | ✓      | ✓       | -      | -       | 高     | 10秒    |
| TC015   | ✓      | -       | -      | -       | 中     | 10秒    |
| TC016   | ✓      | ✓       | ✓      | -       | 高     | 30秒    |
| TC017   | ✓      | -       | -      | -       | 低     | 60秒    |
| TC018   | ✓      | ✓       | -      | -       | 高     | 5秒     |
| TC019   | ✓      | ✓       | -      | -       | 高     | 10秒    |

## 総実行時間
- スモークテスト（高優先度のみ）: 約5分
- フルテスト: 約15分
- 全ブラウザ×全テスト: 約45分

---

作成日: 2025年7月15日